<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>NeumoCalc</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
  <style id="app-style">
    :root {
      --bg-color: #e0e5ec;
      --text-color: #4a5568;
      --accent-color: #6c63ff;
      --error-color: #e53e3e;
      --shadow-color: rgba(0, 0, 0, 0.05);
      --button-bg: #e0e5ec;
      --button-operator: #ffd1dc;
      --button-equals: #c8e6c9;
      --button-clear: #ffecb3;
      --border-radius: 12px;
      --spacing: 12px;
      --transition: 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .calculator {
      background-color: var(--bg-color);
      border-radius: 36px;
      box-shadow: 
        8px 8px 16px var(--shadow-color),
        -8px -8px 16px rgba(255, 255, 255, 0.8);
      padding: 12px;
      max-width: 400px;
      width: 100%;
      overflow: hidden;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .display {
      background-color: var(--bg-color);
      border-radius: var(--border-radius);
      box-shadow: 
        inset 5px 5px 10px var(--shadow-color),
        inset -5px -5px 10px rgba(255, 255, 255, 0.8);
      margin-bottom: 24px;
      padding: 20px;
      text-align: right;
      overflow: hidden;
      position: relative;
    }

    .operation {
      font-size: 16px;
      color: var(--text-color);
      opacity: 0.8;
      height: 24px;
      margin-bottom: 4px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .result {
      font-size: 32px;
      font-weight: 600;
      color: var(--text-color);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      min-height: 48px;
    }

    .result.error {
      color: var(--error-color);
      font-size: 24px;
    }

    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--spacing);
    }

    .button {
      background-color: var(--button-bg);
      border: none;
      border-radius: var(--border-radius);
      color: var(--text-color);
      font-family: 'Montserrat', sans-serif;
      font-size: 20px;
      font-weight: 500;
      padding: 16px 0;
      cursor: pointer;
      box-shadow: 
        5px 5px 10px var(--shadow-color),
        -5px -5px 10px rgba(255, 255, 255, 0.8);
      transition: all var(--transition);
      user-select: none;
    }

    .button:active, .button.active {
      box-shadow: 
        inset 2px 2px 5px var(--shadow-color),
        inset -2px -2px 5px rgba(255, 255, 255, 0.8);
      transform: scale(0.98);
    }

    .button.operator {
      background-color: var(--button-operator);
    }

    .button.equals {
      background-color: var(--button-equals);
    }

    .button.clear {
      background-color: var(--button-clear);
    }

    .button.span-2 {
      grid-column: span 2;
    }

    @media (max-width: 500px) {
      .calculator {
        padding: 16px;
      }
      
      .buttons {
        gap: 8px;
      }
      
      .button {
        padding: 14px 0;
        font-size: 18px;
      }
    }

    @media (max-width: 360px) {
      .calculator {
        width: 100%;
        height: auto;
        min-height: 500px;
        border-radius: 24px;
      }
      
      .buttons {
        gap: 8px;
      }
      
      .button {
        padding: 14px 0;
        font-size: 18px;
      }
    }

    .footer {
      position: fixed;
      bottom: 10px;
      width: 100%;
      text-align: center;
      font-size: 12px;
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <div class="calculator">
    <div class="display">
      <div class="operation" id="operation"></div>
      <div class="result" id="result">0</div>
    </div>
    <div class="buttons">
      <button class="button clear" data-action="clear">C</button>
      <button class="button" data-action="backspace">⌫</button>
      <button class="button operator" data-action="percent">%</button>
      <button class="button operator" data-action="divide">÷</button>
      
      <button class="button" data-digit="7">7</button>
      <button class="button" data-digit="8">8</button>
      <button class="button" data-digit="9">9</button>
      <button class="button operator" data-action="multiply">×</button>
      
      <button class="button" data-digit="4">4</button>
      <button class="button" data-digit="5">5</button>
      <button class="button" data-digit="6">6</button>
      <button class="button operator" data-action="subtract">−</button>
      
      <button class="button" data-digit="1">1</button>
      <button class="button" data-digit="2">2</button>
      <button class="button" data-digit="3">3</button>
      <button class="button operator" data-action="add">+</button>
      
      <button class="button span-2" data-digit="0">0</button>
      <button class="button" data-action="decimal">.</button>
      <button class="button equals" data-action="calculate">=</button>
    </div>
  </div>

  <div class="footer">NeumoCalc © 2025</div>

  <script id="app-script">
    document.addEventListener('DOMContentLoaded', () => {
      // DOM Elements
      const operationEl = document.getElementById('operation');
      const resultEl = document.getElementById('result');
      const buttons = document.querySelectorAll('.button');

      // Calculator state
      let currentInput = '0';
      let currentOperation = '';
      let previousInput = '';
      let shouldResetInput = false;
      let lastOperation = null;

      // Button click animation
      buttons.forEach(button => {
        button.addEventListener('mousedown', () => {
          button.classList.add('active');
        });

        button.addEventListener('mouseup', () => {
          setTimeout(() => {
            button.classList.remove('active');
          }, 100);
        });

        button.addEventListener('mouseleave', () => {
          button.classList.remove('active');
        });

        // Touch support
        button.addEventListener('touchstart', (e) => {
          e.preventDefault();
          button.classList.add('active');
        });

        button.addEventListener('touchend', (e) => {
          e.preventDefault();
          setTimeout(() => {
            button.classList.remove('active');
          }, 100);
        });
      });

      // Handle number input
      function inputDigit(digit) {
        if (shouldResetInput) {
          currentInput = digit;
          shouldResetInput = false;
        } else {
          currentInput = currentInput === '0' ? digit : currentInput + digit;
        }
        updateDisplay();
        updateOperationDisplay();
      }

      // Handle decimal point
      function inputDecimal() {
        if (shouldResetInput) {
          currentInput = '0.';
          shouldResetInput = false;
        } else if (currentInput.indexOf('.') === -1) {
          currentInput += '.';
        }
        updateDisplay();
        updateOperationDisplay();
      }

      // Handle operations
      function handleOperation(operation) {
        updateOperationDisplay();
        const inputValue = parseFloat(currentInput);

        if (previousInput === '' && !isNaN(inputValue)) {
          previousInput = currentInput;
        } else if (!isNaN(inputValue) && lastOperation) {
          const result = performCalculation();
          previousInput = result;
          resultEl.textContent = formatNumber(result);
        }

        lastOperation = operation;
        shouldResetInput = true;
        updateOperationDisplay();
      }

      // Calculate result
      function performCalculation() {
        const prev = parseFloat(previousInput);
        const current = parseFloat(currentInput);
        
        if (isNaN(prev) || isNaN(current)) return current;
        
        let result;
        
        switch (lastOperation) {
          case 'add':
            result = prev + current;
            break;
          case 'subtract':
            result = prev - current;
            break;
          case 'multiply':
            result = prev * current;
            break;
          case 'divide':
            if (current === 0) {
              showError('División por cero');
              return prev;
            }
            result = prev / current;
            break;
          case 'percent':
            result = prev * (current / 100);
            break;
          default:
            return current;
        }
        
        return result;
      }

      // Calculate button action
      function calculate() {
        updateOperationDisplay();
        if (lastOperation === null || previousInput === '') {
          return;
        }
        
        const result = performCalculation();
        
        currentOperation = '';
        currentInput = String(result);
        previousInput = '';
        lastOperation = null;
        shouldResetInput = true;
        
        updateDisplay();
        operationEl.textContent = '';
      }

      // Clear calculator
      function clearCalculator() {
        currentInput = '0';
        previousInput = '';
        currentOperation = '';
        lastOperation = null;
        shouldResetInput = false;
        updateDisplay();
        operationEl.textContent = '';
        resultEl.classList.remove('error');
      }

      // Backspace function
      function handleBackspace() {
        if (currentInput.length === 1 || (currentInput.length === 2 && currentInput.startsWith('-'))) {
          currentInput = '0';
        } else {
          currentInput = currentInput.slice(0, -1);
        }
        updateDisplay();
      }

      // Update the operation display
      function updateOperationDisplay() {
        let operationText = '';
        
        if (previousInput !== '') {
          operationText = formatNumber(previousInput);
          
          switch (lastOperation) {
            case 'add':
              operationText += ' + ';
              break;
            case 'subtract':
              operationText += ' − ';
              break;
            case 'multiply':
              operationText += ' × ';
              break;
            case 'divide':
              operationText += ' ÷ ';
              break;
            case 'percent':
              operationText += ' % ';
              break;
          }
        }
        
        if (!shouldResetInput && currentInput !== '0') {
          operationText += formatNumber(currentInput);
        }
        
        operationEl.textContent = operationText;
      }

      // Format number for display
      function formatNumber(num) {
        const numberStr = String(num);
        
        if (numberStr.includes('e')) {
          // Handle scientific notation
          return numberStr;
        }
        
        const parts = numberStr.split('.');
        parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        
        return parts.join('.');
      }

      // Update calculator display
      function updateDisplay() {
        resultEl.textContent = formatNumber(currentInput);
      }

      // Show error
      function showError(message) {
        resultEl.textContent = message;
        resultEl.classList.add('error');
        setTimeout(() => {
          resultEl.classList.remove('error');
          updateDisplay();
        }, 2000);
      }

      // Event listeners for buttons
      buttons.forEach(button => {
        button.addEventListener('click', () => {
          // If error is showing, clear it
          resultEl.classList.remove('error');

          if (button.dataset.digit !== undefined) {
            inputDigit(button.dataset.digit);
          } else if (button.dataset.action) {
            const action = button.dataset.action;
            
            switch (action) {
              case 'decimal':
                inputDecimal();
                break;
              case 'clear':
                clearCalculator();
                break;
              case 'backspace':
                handleBackspace();
                break;
              case 'calculate':
                calculate();
                break;
              case 'add':
              case 'subtract':
              case 'multiply':
              case 'divide':
              case 'percent':
                handleOperation(action);
                break;
            }
          }
        });
      });

      // Keyboard support
      document.addEventListener('keydown', (event) => {
        const key = event.key;
        
        if (/^[0-9]$/.test(key)) {
          // Numbers
          inputDigit(key);
        } else if (key === '.') {
          // Decimal
          inputDecimal();
        } else if (key === '+') {
          handleOperation('add');
        } else if (key === '-') {
          handleOperation('subtract');
        } else if (key === '*') {
          handleOperation('multiply');
        } else if (key === '/') {
          event.preventDefault();
          handleOperation('divide');
        } else if (key === '%') {
          handleOperation('percent');
        } else if (key === 'Enter' || key === '=') {
          calculate();
        } else if (key === 'Backspace') {
          handleBackspace();
        } else if (key === 'Escape' || key === 'Delete') {
          clearCalculator();
        }
      });
    });
  </script>
</body>
</html>